1999-05-02  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.0.5.

	* arch/msdos/archdep.c (archdep_path_is_relative): Check for NULL
	pointer.
	* arch/win32/archdep.c: Changed likewise.

	* arch/msdos/types.h, arch/riscos/types.h, arch/unix/types.h,
	arch/win32/types.h: New files.

	* types.h: Removed.

	* c1541.c: Use `HAVE_READLINE' instead of obsolete `EDIT' define.

	* vice.h: Removed `EDIT' define.

	* vicii/vicii.c, vic20/vic.c, crtccore.c: Fixed prototype.

	* autostart.c (autostart_autodetect): More verbose logging.
	(autostart_advance): Press play on datasette if a tape image is
	attached.

	* drive/drivecpu0.c, drive/drivecpu1.c, 6510core.c: Use
	`DRIVE_CPU' instead of obsolete `__1541__'.

	* pet/petmem.c: Removed some cruft.

	* memcmp.c, info.h: Added proper copyright notice.

1999-05-01  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.0.4.

	* arch/msdos/c64ui.c (c64_ui_init): Commented out usused menu. 

	* arch/msdos/archdep.c (archdep_default_sysfile_pathlist): Add the
	boot path to the default path.

	* system.c (set_system_path): Also consider the drive letter on
	MSDOS.

	* arch/unix/xaw/uiedisk.c: #include "utils.h".

	* arch/unix/xaw/video.h, arch/unix/xaw/video.c: Moved
	`canvas_refresh' to `video.c'.

	* arch/unix/xaw/widgets/TextField.c: Added some prototypes.

1998-05-01  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* cia.h (byte2bcd, bcd2byte): fix macros

	* ciacore.c (int_ciatod): fix handling of am/pm bit

	* drive/drive.h (drive0_via_set_atn, drive1_via_set_atn,
	drive0_riot_set_atn, drive1_riot_set_atn): add prototypes

1999-04-29  Tibor Biczo  <crown@mail.matav.hu>

	* arch/win32/c128.dsp: Enabled optimizations for c128mem.c.

	* arch/win32/drive.dsp: Added fdc0.c, fdc1.c, riot1drive0.c,
	  riot2drive0.c into drive project.

	* arch/win32/vice.dsw: Corrected relativ paths of subprojects.

	* c128/c128mem.c (initalize_memory): Turned off optimizations for
	  this function when compiling with MSVC. Version 5.0SP3 died
	  with internal compiler error on it.

	* drive/drivecpucore.c (mydrive_mem_init): Same here as above.

1999-04-28  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.0.3.

	* c128/c128mem.c (initialize_memory): Fixed IO banking.

	* drive/drive.c: Changed default name of 1541-II ROM.

	* drive/drivecpucore.c (reset): Changed name of the reset
	function.
	* drive/viad.h, via1drive0.c, via1drive1.c, via2drive0.c,
	via2drive1.c, vic20/vic20via.h, vic20/vic20via1.c,
	vic20/vic20via2.c, pet/petvia.c, pet/petvia.h, c64/c64cia1.c,
	c64/c64cia2.c, c64/c64cia.h, ciacore.c, drive/ciad.h,
	drive/cia1571drive0.c, drive/cia1571drive1.c,
	drive/cia1581drive0.c, drive/cia1581drive1.c, c128/c128cia1.c,
	cbm2/c610cia.h, cbm2/c610cia1.c, drive/wd1770.h, drive/wd1770.c,
	drive/riotd.h, drive/riot1drive0.c, drive/riot2drive0.c,
	riotcore.c, drive/drivecpu0.c, drive/drivecpu1.c, c64/c64.c,
	c128/c128.c, vic20/vic20.c, pet/pet.c, cbm2/c610.c: Likewise.

1998-04-28  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* doc/vice.texi: add some explanation to the drive emulation
	cmdline options -parallel8/9 fixed
	added -drive8extend and -drive9extend options
	added -dos1001 option
	added -joydev1, -joydev2 options

	* arch/unix/joystick.c (cmdline_options): change "0-5" to "0-6"
	for the available joystick devices.

	* drive/drive.c (cmdline_options): add -drive8extend and -drive9extend
	options

1998-04-27  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* drive/Makefile.am: add fdc.h, fdc0.c, fdc1.c, fdccore.h, and
	fdccore.c

	* drive/drivecpu0.c: include fdc.h
	(myfdc_reset, myfdc_init): new defines
	* drive/drivecpu1.c: likewise

	* drive/drivecpucore.c (mydrive_read_1001buffer_ram,
	mydrive_store_1001buffer_ram): fix address computation
	(reset): call myfdc_reset
	(mydrive_cpu_early_init): call myfdc_init

	* drive/fdc.h, drive/fdc0.c, drive/fdc1.c, drive/fdccore.c,
	drive/fdccore.h: new files to handle FDC emulation
	for the two drives.

1998-04-27  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* arch/unix/xaw/Makefile.am: add uiedisk.h, uiedisk.c

	* arch/unix/xaw/uicommands.c (attach_empty_disk): new callback
	(attach_empty_disk_image_submenu). new submenu to attach
	an empty disk
	(ui_disk_commands_menu): call attach_empty_disk_image_submenu

	* arch/unix/xaw/uiedisk.c: new file, derived from uisnapshot.c

	* arch/unix/xaw/uiedisk.h: new file, derived from uisnapshot.h

	* arch/unix/xaw/uisnapshot.c (browse_callback, cancel_callback,
	save_callback): make static

1998-04-26  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* c64/c64mem.c (mem_romset_resources): fix list (add 1541ii, 1001)
	* c128/c128mem.c: likewise
	* vic20/vic20mem.c: likewise
	* pet/petmem.c: likewise
	* cbm2/c610mem.c: likewise

1998-04-26  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* data/DRIVES/Makefile.am: add dos1001

	* arch/unix/xaw/uisettings.c (set_drive0_type_submenu,
	set_drive1_type_submenu): add SFD1001 entry

	* drive/Makefile.am: add riotd.h

	* drive/drive.c: include riotd.h
	(drive_load_1001, dos_rom_name_1001, set_dos_rom_name_1001,
	drive_rom1001, rom1001_loaded): new function/variable
	(set_drive0_type, set_drive1_type, drive_init,  
	drive_set_active_led_color, drive_set_disk_drive_type,
	drive_load_rom_images, drive_setup_rom_image, drive_check_image_format,
	drive_match_bus, drive_write_snapshot_module,
	drive_read_snapshot_module): handle new SFD1001 case
	(resources, commandline_options): new "DosName1001" and "-dos1001"
	entries

	* drive/drive.h (DRIVE_ROM1001_SIZE, DRIVE_TYPE_1001): new defs.

	* drive/drivecpu0.c: include riotd.h
	(reset_myriot1, reset_myriot2, read_myriot1, read_myriot2,
	store_myriot1, store_myriot2, myriot1_init, myriot2_init): new defs
	* drive/drivecpu1.c: likewise

	* drive/drivecpucore.c (read_func, store_func, read_func_watch,
	store_func_watch, read_func_nowatch, store_func_nowatch):
	increase size from 65 to 257, using each entry for 256 byte instead
	of 1024
	(LOAD, STORE): adjust to new table format
	(mydrive_read_1001_io, mydrive_store_1001_io, 
	mydrive_read_1001zero_ram, mydrive_store_1001zero_ram, 
	mydrive_read_1001buffer_ram, mydrive_store_1001buffer_ram): 
	new functions to handle 1001/8050/8250 memory access
	(JUMP): do not use bank_base optimization for SFD1001 :-(
	(pageone): made variable to be able to set it to drive_ram 
	or (drive_ram + 0x100)
	(mydrive_read, mydrive_store, drive_bank_read, drive_bank_peek,
	drive_bank_store): adjust to new table format
	(reset): reset RIOTs as well
	(mydrive_mem_init): adjust to new memory table format, also handle
	new SFD1001 case
	(mydrive_toggle_watchpoints): adjust to new mem table size
	(mydrive_cpu_early_init): init RIOTs as well
	(drive_jam): handle new 1001 case
	(mydrive_cpu_write_snapshot_module): adjust RAM size to save for 1001
	(mydrive_cpu_read_snapshot_module): reset RIOTs as well
	adjust RAM size to read for SFD1001

	* drive/riotd.h: new file with RIOT1/2 definitions for drive 0/1

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* Makefile.am: add riot.h, riotcore.h and riotcore.c

	* drive/Makefile.am: add riot1drive0.c, riot2drive0.c

	* drive/drive.c (drive1_riot_set_atn): dummy 
	(drive0_parallel_set_atn, drive1_parallel_set_atn): replace
	functions in the VIA code. Call VIA _and_ RIOT functions to 
	set ATN flags

	* drive/riot1drive0.c, drive/riot2drive0.c: new files

	* drive/riotd.h (riot1d0_signal, riot2d0_signal, riot1d1_signal, 
	riot2d1_signal): new prototypes
	remove empty redefines for the two drive 0 RIOTs

	* drive/via1drive0.c (drive0_via_set_atn): renamed from 
	drive0_parallel_set_atn
	* drive/via1drive1.c: likewise

	* riot.h, riotcore.c, riotcore.h: new files to emulate the 
	RIOT 6532 and the 6530.

1999-04-25  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.0.2.

	* fsdevice.c (read_fs) [Directory]: Corrected off by one error in
	directory listing.

	* c1541.c (block_cmd, extract_cmd): Removed special 1541 handling.

	* c64/c64mem.c (read_io1, store_io1, read_io2, store_io2): Removed
	cartirdge specific routines.
	(mem_attach_cartridge, mem_detach_cartridge,
	mem_freeze_cartridge, cartridge_config_changed, read_roml,
	read_romh, store_roml): Removed.
	(pla_config_changed): Made non-static.

	* c64/c64cartmem.c: New file.

	* c64/c64cart.h: New prototypes for `c64cartmem.c'.

	* c64/Makefile.am: Added `c64cartmem.c' to `libc64_a_SOURCES'.

	* mem.h: Removed cartridge specific functions.

	* cartridge.h (cartridge_attach, cartridge_detach,
	cartridge_freeze): Prototypes moved here.

	* vic20/cartridge.c: #include "vic20mem.h".

	* vic20/vic20mem.h: Added prototypes for `mem_attach_cartridge'
	and `mem_detach_cartridge'.

	* interrupt.h: Defined interrupt types here.

	* vmachine.h: Removed.

	* autostart.c, kbdbuf.c, maincpu.c, interrupt.h, raster.h,
	c64/c64.c, c64/c64cia1.c, c64/c64cia2.c, c64/c64mem.c,
	c64/cartridge.c, viacore.h, aciacore.c, crtccore.c, raster.c,
	rsuser.c, c128/c128.c, c128/c128cia1.c, c128/c128mem.c,
	vic20/cartridge.c, vic20/vic.c, vic20/vic20.c, vic20/vic20mem.c,
	pet/pet.c, pet/petmem.c, pet/petpia1.c, cbm2/c610.c,
	cbm2/c610cia1.c, cbm2/c610mem.c, vicii/vicii.c, arch/unix/kbd.c,
	arch/msdos/kbd.c, arch/msdos/vsync.c, arch/riscos/kbd.c: Do not
	include `vmachine.h'.

1999-04-25  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.0.1.

	* Makefile.am, arch/unix/Makefile.am, arch/unix/xaw/Makefile.am,
	arch/win32/Makefile.am, arch/msdos/Makefile.am,
	arch/riscos/Makefile.am: Removed `PREFIX' from `INCLUDES'.

	* arch/unix/archdep.h: #include "vice.h".

	* arch/unix/xaw/ui.c, arch/unix/xaw/ui.h
	(ui_is_fullscreen_available): Fixed prototype.

	* imagecontents.c (open_image): Also include d80 and d82 disk
	images.
	* arch/msdos/menudefs.c (attach_disk_callback): Likewise.
	* arch/win32/ui.c (handle_wm_command): Likewise.

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* Makefile.am: add piacore.c, piacore.h, remove pia-tmpl.c

	* pet/Makefile.am: remove petpia*.def and builf rules for it.

	* pet/petpia1.c, pet/petpia2.c: basically a copy of the old .def
	files, with names/defs changed to fit the new piacore file.
	includes piacore.c at the end

	* pet/petpia1.def, pet/petpia2.def: removed

	* pia-tmpl.c: removed

	* piacore.c, piacore.h: new files made out of pia-tmpl.c

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* Makefile.am: add tpicore.c, tpicore.h, remove tpi-tmpl.c

	* c64/Makefile.am: remove c64tpi*.def and builf rules for it.
	* cbm2/Makefile.am: remove c610tpi*.def and builf rules for it.

	* c64/c64tpi.c, cbm2/c610tpi1.c, cbm2/c610tpi2.c: basically a copy 
	of the old .def files, with names/defs changed to fit the new 
	tpicore file. includes tpicore.c at the end

	* c64/c64tpi.def, cbm2/c610tpi1.def, cbm2/c610tpi2.def: removed

	* tpi-tmpl.c: removed

	* tpicore.c, tpicore.h: new files made out of tpi-tmpl.c

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* Makefile.am: remove bogus tpi-tmpl.c, add tpicore.c and tpicore.h

	* aciacore.c (acia_last_read): new variable to save value last
	read, needed for RMW cycles.
	(store_myacia): add handling of rmw_flag
	(read_myacia): save value in acia_last_read.

	* c64/c64acia1.c, cbm2/c610acia1.c, pet/petacia.c (mycpu_rmw_flag):
	new define 

	* ciacore.c (read_mycia): move PRE_READ_CIA from before RMW flag
	handling to behind so that it always gets called in the right
	order clk-wise.

	* drive/via1drive0.c, drive/via1drive1.c, drive/via2drive0.c,
	drive/via2drive1.c, pet/petvia.c, vic20/vic20via1.c,
	vic20/vic20via2.c (myrmwf): removed.
	(mycpu_rmw_flag): new define

	* viacore.c (via_read_clk, via_read_offset): new variables to 
	handle opcode fetches in the I/O area
	(via_last_read): new variable for RMW handling
	(reset_myvia): use proper name for log name.
	set via_read_clk to 0
	(store_myvia): add handling of RMW flag
	(read_myvia): add handling of opcode fetch in I/O area.
	Save value read in via_last_read variable.
	(clk_overflow_callback): handle via_read_clk

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* c128/c128.c, c64/c64.c (machine_init): add call to tpi_init()

	* c64/c64tpi.c, cbm2/c610tpi1.c, cbm2/c610tpi2.c (mytpi_init):
	new define

	* c64/c64tpi.h (tpi_init): new prototype
	* cbm2/c610tpi.h: likewise

	* cbm2/c610.c (machine_init): call tpi1_init, tpi2_init

	* /pet/pet.c (machine_init): call pia1_init, pia2_init

	* pet/petpia.h (pia1_init, pia2_init): new prototypes

	* pet/petpia1.c, pet/petpia2.c (mypia_init): new define

	* ciacore.c (mycia_init, reset_mycia): move log init from reset 
	to init.
	* viacore.c: likewise

	* piacore.c (mypia_init): new function, move log here from reset

	* tpicore.c (mytpi_init): new function, move log here from reset

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* c64/c64tpi.c: include maincpu.h
	(mycpu_rmw_flag, myclk): new defines
	* cbm2/c610tpi1.c: likewise
	* cbm2/c610tpi2.c: likewise
	* pet/petpia1.c: likewise
	* pet/petpia2.c: likewise

	* piacore.c (pia_last_read): new variable to handle RMW cycles
	(store_mypia): handle RMW cycles
	(read_mypia): save value read in pia_last_read

	* tpicore.c (tpi_last_read): new variable to handle RMW cycles
	(store_mytpi): handle RMW cycles
	(read_mytpi): save value read in tpi_last_read

1998-04-25  André Fachat  <a.fachat@physik.tu-chemnitz.de>

	* c1541.c (Legal_formats): fix number of blocks for 8050.
	(command_list): add description of 8050/8250 disks
	(open_image): recognize D80/D82 images
	(format_cmd): recognize D80/D82 image type for formats

	* fs_cbm.h (BAM_BIT_MAP_8050, BAM_BIT_MAP_8250, BAM_VERSION_8050,
	BAM_VERSION_8250, ...) add/fix various defines for the 8050/8250
	format types.
	(hdrinfo): add flags for d80/d82 format

	* vdrive.c (floppy_free_block_count): handle 8050/8250 BAMs
	(vdrive_command_validate): fix (maximum) BAM size
	(vdrive_command_format): use some common routines only if not
	8x50 disk. Build complete new BAM chain for 8x50 disks.
	(vdrive_dir_find_next_slot): handle 8x50 disks when looking
	for a new (empty) directory block.
	(vdrive_calculate_disk_half, vdrive_get_max_sectors,
	vdrive_bam_sector_free): handle 8x50 disks
	(vdrive_bam_calculate_track): handle 8x50 BAM when calculating 
	the track field position in the BAM
	(vdrive_bam_clear_all): also clear 8x50 BAM
	(vdrive_bam_read_bam, vdrive_bam_write_bam): read/write 8x50 BAM 
	as well.
	(attach_floppy_image): recognize D80/D82 images
	(get_std80_header, get_std82_header): new fucntions. Do sanity
	check on to be attached image
	(check_header): clear d80/d82 flags in header; check file length
	for d80/d82 images
	(set_disk_geometry): set appropriate values for 8x50 images
	
	* vdrive.h (struct _DRIVE): adjust maximum BAM size
	(D80_FILE_SIZE, D82_FILE_SIZE, IS_D80_LEN, IS_D82_LEN):
	add d80/d82 file sizes and check macros
	(DISK_IMAGE_TYPE_D80, DISK_IMAGE_TYPE_D82): new defines

