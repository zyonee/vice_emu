2002-01-31  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.9.

	* raster/raster.c (raster_free): Check if canvas is allocated.
	(raster_init): Initialize draw buffer pointer.

2002-01-31  Tibor Biczo  <crown@axelero.hu>

	* arch/win32/plus4ui.c: Added PAL emulation switch to UI.

	* arch/win32/resplus4.rc: Added PAL emulation switch to UI.

	* arch/win32/video.c (video_canvas_create): Fixed typo.

	* datasette.c (datasette_read_gap): Implemented version 1 and
	version 2 TAP reading for Plus4.
	(datasette_set_tape_image, datasette_internal_reset): Reset
	fullwave flag.
	(datasette_start_motor): Don't change fullwave flag.

	* plus4/plus4.h: Updated cycles in line to 114, and cycles per
	sec values both for PAL and NTSC.

	* plus4/plus4mem.c (mem_proc_port_read): Fixed CST READ
	sygnal.

	* plus4/ted-timer.c: Updated timers to work correctly on
	double clock, and implemented read accesses.

	* plus4/tedtypes.h: Fixed NTSC screen height.

2002-01-31  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* raster/raster.c: Sun compiler doesn't allow returning void

2002-01-31  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/ui.c
	(ui_open_canvas_window): Change canvas background color to
	black.

	* arch/unix/x11/renderxv.c (render_4_2_2, render_4_1_1):
	Average U and V values in source pixel block.

	* arch/unix/x11/video.c: Added +xvideo command line parameter.

2002-01-30  pottendo  <pottendo@utanet.at>

	* uicolor.h (uicolor_init_video_colors): New prototype.

	* arch/unix/x11/video.c (video_canvas_create): Request
	initialization of colors.

	* arch/unix/x11/gnome/uicolor.c (uicolor_init_video_colors): New
	function, initialize the video layer with pixel values.
	* arch/unix/x11/xaw/uicolor.c (uicolor_init_video_colors):
	Likewise.

	* arch/unix/uivicii.c: Reworked PAL related menus and callbacks. 

2002-01-30  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.8.

	* vicii/vicii-mem.c (store_d019): Removed some leftovers.

	* vicii/vicii-draw.c (_draw_mc_text): Replaced remaining
	`PIXEL' type.

	* arch/unix/x11/videoarch.h, arch/win32/videoarch.h,
	arch/msdos/videoarch.h, arch/riscos/videoarch.h,
	arch/os2/videoarch.h, arch/beos/videoarch.h: Added draw buffer
	alloc/free/clear callback to the canvas struct.

	* arch/unix/x11/video.c, arch/win32/video.c,
	arch/msdos/video.c, arch/riscos/video.c, arch/os2/video.c,
	arch/beos/video.cc (video_canvas_creat): Initialize draw
	buffer callback.

	* raster/raster.c (raster_draw_buffer_alloc,
	raster_draw_buffer_free, raster_draw_buffer_clear): Added
	callbacks for arch specific draw buffer allocation.
	(raster_force_repaint): Do not clear draw buffer.
	(realize_frame_buffer): Do not realize frame buffer (should be
	called draw buffer now) if there is no canvas.

	* video.h: Added structure for draw buffer callbacks.

2002-01-30  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* doc/vice.texi:
	- changed a bug in my email address
     
	* arch/os2/dialogs/menubar.[h,c,rc]:
	- implemented the new PAL Emulation modes
     
	* arch/os2/vac++/incl/video.icc:
	- added the new renderers
     
	* arch/os2/video.c:
	- implement usage of the new renderers (only R565 supported
	yet)
	- replaced most of the 'in code' #ifdefs by if statements
   
	* arch/os2/videoarch.h:
	- added bDepth to canvas_t
     
	* raster/raster.c:
	- made sure that video_canvas_refresh is never called with 
	heights which exceeds the viewport area
	- replaced a free/malloc combination by a realloc
	- small simplifications to the code
     
	* utils.c:
	- replaced to additions in stralloc by one

2002-01-29  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Call new find_yuv_port
	interface.

	* arch/unix/x11/renderxv.c: Added support for UYVY, YUY2,
	YVYU, and IYUV.

	* arch/unix/x11/renderxv.c: New find_yuv_port interface
	exporting the render function for the selected YUV format.

	* arch/unix/x11/video.c (video_canvas_refresh): Pick up
	another offscreen bug from the raster layer.

	* arch/unix/x11/videoarch.h: Added xv_render to
	video_canvas_s.

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Call new find_yuv_port
	interface.

2002-01-29  Tibor Biczo  <crown@axelero.hu>

	* arch/win32/main_exit.c (main_exit): Removed putchar call.

	* sounddrv/sounddx.c, sounddrv/soundwmm.c (sound_suspend):
	Fixed a bug where the stack was overwritten if stereo sound
	was enabled.

2002-01-29  John Selck  <graham@cruise.de>

	* arch/win32/videoarch.h: Removed PIXEL *pixel_translate
	from video_canvas_t definition and changed PIXEL *pixels
	into BYTE *pixels.

	* arch/win32/video.c: set_physical_colors() no longer updates
	pixels and pixel_translate in video_canvas_t.
	video_canvas_create() no longer allocates pixel_translate[].

	* arch/win32/video.dsp: Added render1x1pal.c and
	render2x2pal.c to project.

2002-01-29  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c: Added X Video handling.

	* arch/unix/x11/gnome/ui.c (ui_create_status_bar): Glue fixed
	size status bar to bottom.
	(ui_open_canvas_window): Glue resizeable canvas to top.

	* arch/unix/x11/video.c (video_canvas_resize): Don't attempt
	to resize canvas for Xv.
	(video_canvas_refresh): GDK X typecasts for Window and GC
	passed to Xv.

2002-01-28  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.7.

	* vicii/vicii-mem.c (store_d019): Also remove pending raster
	alarms that would be schedulded before the end of the store.

	* plus4/ted-mem.c (ted09_store): Changed likewise.

	* video/Makefile.am: Added new files.
	
2002-01-27  John Selck  <graham@cruise.de>

	* arch/win32/resc64.rc: Renamed "Fast PAL" menu entry into
	"PAL Emulation".

	* arch/win32/resvic.rc: Renamed "Fast PAL" menu entry into
	"PAL Emulation".
 
	* video/video-color.c: Added global tables gamma_*[],
	gamma_*_fac[] and color_*[].
	Added video_render_setrawrgb() function.
	Added video_render_initraw() function.
	Added video_gamma() function.
	video_convert_ycbcr_to_rgb() now uses video_gamma()
	instead of it's own calculation routines.
	video_calc_gammatable() now fills the gamma_*[] and
	gamma_*_fac[] tables with the gamma corrected color
	channels.
 
	* video.h: Added prototypes for video_render_setrawrgb()
	and video_render_initraw().
 
	* arch/win32/video.c: set_physical_colors() now hands the
	RGB color channels to the video_render_setrawrgb() function.
 
	* video/render1x1pal.h: Added file.

	* video/render1x1pal.c: Added file.

	* video/render2x2pal.h: Added file.

	* video/render2x2pal.c: Added file.

	* video/video-render.c: Changed video_render_main() to call
	pal renderers.
 
	* video/video-resources.h: Removed pal_emulation variable and
	added pal_scanlineshade and pal_mode to video_resources_t
	definition.
	Added defines for different pal rendermodes.

	* video/video-resources.c: Removed initialisation routines for
	pal_emulation and added init routines for pal_scanlineshade
	and pal_mode.
	Added resource variables "PALScanLineShade" and "PALMode".
 
	* raster/raster.c: update_canvas() now enlarges the update area
	a bit more when pal emulation is activated.

2002-01-27  pottendo  <pottendo@utanet.at>

	* arch/unix/x11/gnome/ui.c (ui_open_canvas_window): Added Ettore's
	suggested fix for the BadMatch problem on Solaris. 

	* arch/unix/x11/video.c (video_register_raster): Replaced
	`USE_XF86_EXTENSIONS' with `USE_XF86_DGA2_EXTENSIONS'.
	(video_canvas_refresh): Likewise.

	* arch/unix/x11/gnome/ui.c: Fixed include for `vsiduiunix.h'.

	* arch/unix/x11/gnome/uicolor.c (uicolor_alloc_color): Replace
	PIXEL by BYTE.

	* arch/unix/vsidui.c (vsid_ui_init): attach handlers to window;
	this fixes the nonworking hotkeys for Xaw.

2002-01-27  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/install.cmd:
	- removed 'Evaluation'
   
	* arch/os2/makedist.cmd:
	- changed to new paths
	- added "del vice2.zip"
   
	* arch/os2/vac++/RESID.ICC:
	- changed to version 0.13
   
	* arch/os2/video.c:
	- removed wmvrndisabled from set_stretch_factor
	- removed video_frame_buffer_*
	- changed functions from using frame_buffer to draw_buffer
   
	* raster/raster.c, src/screenshot.h, src/video.h:
	- added draw_buffer_height to calls of video_canvas_refresh
	for OS/2 (needed to make 100% sure, that we don't read behind
	the buffer, will be removed again as soon as the whole new
	video/pal, etc stuff is working completely)

2002-01-27  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.6.

	* vicii/vicii.c (vic_ii_update_video_mode): Propagate changes
	of multicolor mode one cycle faster.

	* arch/unix/x11/video.c, arch/unix/x11/videoarch.h,
	arch/unix/x11/ui-resources.c, arch/unix/x11/uihotkey.c,
	arch/unix/x11/ui-cmdline-options.c: Fixed some includes.

	* arch/unix/x11/xaw/ui.c, arch/unix/x11/gnome/ui.c
	(ui_init_finish): Read selected display depth from resource.

	* arch/unix/x11/video.c, arch/unix/x11/xaw/x11video.c,
	arch/unix/x11/gnome/gnomevideo.c, arch/unix/x11/videoarch.h:
	Removed unused depth parameter from `video_convert_func()'.

	* arch/win32/msvc/config.h, arch/riscos/config.h,
	arch/os2/config.h, raster/raster.c: Removed remaining
	`VIDEO_DISPLAY_DEPTH' defines.

	* arch/unix/x11/xaw/uicolor.c, arch/unix/x11/gnome/uicolor.c,
	arch/unix/x11/video.c, arch/unix/x11/videoarch.h: Use depth
	specified in the canvas.

2002-01-27  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/Makefile.am: Added renderXv.c, renderXv.h.

	* arch/unix/x11/renderXv.c, arch/unix/x11/renderXv.h: New
	files, X Video rendering.

	* arch/unix/x11/video.c: Added X Video handling.

	* arch/unix/x11/videoarch.h: Likewise.

	* arch/unix/x11/xaw/x11video.c: Likewise.

	* raster/raster.c (raster_init): Call video_register_raster
	for X Video.

	* video/video-color.c (video_calc_ycbcrtable): Build YUV table
	for X Video rendering.

2002-01-26  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.5.

	* arch/unix/x11/video.c, arch/unix/x11/xaw/x11video.c,
	arch/unix/x11/gnome/gnomevideo.c, video.h, raster/raster.c,
	arch/unix/x11/videoarch.h, arch/win32/video.c,
	arch/msdos/video.c, arch/riscos/video.c, arch/os2/video.c,
	arch/beos/video.cc, raster/raster.h, screenshot.h,
	arch/win32/videoarch.h, arch/msdos/videoarch.h,
	arch/beos/videoarch.h, arch/msdos/statusbar.h: Removed
	redundant video frame buffer API.

	arch/unix/x11/xaw/uicolor.c, arch/unix/x11/gnome/uicolor.c,
	uicolor.h, color.c, arch/unix/x11/videoarch.h,
	arch/unix/x11/video.c, arch/unix/x11/xaw/x11video.c,
	arch/unix/types.h, arch/win32/types.h, arch/msdos/types.h,
	arch/riscos/types.h, arch/os2/types.h, arch/beos/types.h:
	Removed obsolete `PIXEL' support.

2002-01-25  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.4.

	* raster/raster.c, raster/raster.h, raster-sprite-status.h,
	video.h, arch/unix/x11/video.c, arch/win32/video.c,
	arch/msdos/video.c, arch/riscos/video.c, arch/os2/video.c,
	arch/beos/video.cc, vicii/vicii-draw.c, vicii/vicii-sprites.c,
	crtc/crtc-draw.c, vic20/vic-draw.c, vic20/vic.h,
	plus4/ted-draw.c, screenshot.h, arch/unix/x11/xaw/ui.c,
	arch/unix/x11/gnome/ui.c, arch/unix/x11/xaw/uicolor.c,
	arch/unix/ui.h, uicolor.h, screenshot.c, color.c, color.h:
	Removed support for variable pixel size as the draw buffer
	uses 8bpp all the time now.

2002-01-24  Dag Lem  <resid@nimrod.no>

	* arch/unix/plus4ui.c: Removed #if VIDEO_DISPLAY_DEPTH == 0

	* arch/unix/uivicii.c: Likewise

	* arch/unix/x11/gnome/uicolor.c: Likewise

	* arch/unix/x11/xaw/uicolor.c: Likewise

	* arch/unix/x11/video.c: Make VIDEO_DISPLAY_DEPTH != 0 almost
	work.

	* arch/unix/x11/videoarch.c: Removed VIDEO_FRAME_BUFFER_xxx
	macros.

2002-01-24  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/videoarch.h,video.cc, msdos/videoarch.h,video.c:
	Removed obsolete video_frame_buffer stuff. Adapted call off
	video_render_main.

	* arch/win32/plus4.dsp: Updated files for plus4 library.

	* arch/win32/vice.dsw: xplus4 doesn't depent on sid and resid.

2002-01-22  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.3.

	* arch/win32/video.c (video_canvas_refresh, real_refresh): Use
	draw buffer.
	(video_frame_buffer_alloc, video_frame_buffer_free,
	video_frame_buffer_clear): Removed temp frame buffer code.
	(video_frame_buffer_translate): Removed.

	* arch/win32/fullscreen.c (SwitchToFullscreenMode,
	SwitchToWindowedMode): Removed call to
	`video_frame_buffer_translate()'.

	* arch/win32/videoarch.h: Removed `VIDEO_FRAME_BUFFER_*'
	macros.

	* plus4/plus4mem.c (fdxx_read, fdxx_store): Only call ACIA if
	the arch supports RS232.

2002-01-22  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.2.

	* raster/raster.c, vicii/vicii-draw.c, vdc/vdc-draw.c,
	crtc/crtc-draw.c, vic20/vic-draw.c, plus4/ted-draw.c,
	arch/unix/x11/videoarch.h, arch/riscos/videoarch.h, video.h,
	arch/unix/x11/video.c, arch/win32/video.c, arch/msdos/video.c,
	arch/riscos/video.c, arch/os2/unused/video_gpi.h,
	arch/os2/unused/video_gpi.c, arch/os2/video.c: Allocate draw
	buffer in the raster layer instead of allocating it the
	architecture dependent code.

	arch/unix/x11/video.c (video_canvas_refresh, convert_8to8,
	convert_8to16, convert_8to32, convert_8to1_dither,
	convert_8toall): Changed to new API.

	* screenshot.h: Added new members to `screenshot_t'.

	* screenshot.c (screenshot_line_data): Use draw buffer.

	* raster/raster.c, raster/raster.h, arch/win32/video.c,
	vicii/vicii.c, vdc/vdc.c, crtc/crtc.c, vic20/vic.c,
	plus4/ted.c: `raster_set_geometry()' takes separate extra
	border offsets for the left and right side now.

2002-01-21  Andreas Boose  <boose@linux.rz.fh-hannover.de>

        * Version 1.8.1.

	* vicii/vicii-draw.c (get_mc_text, get_ext_text): Fixed color
	register usage.

	* video/video-render.c, raster/raster.c, vicii/vicii-draw.c,
	vicii/vicii-sprites.c, crtc/crtc-draw.c, vic20/vic-draw.c,
	vic20/vic-mem.c, vic20/vic.c, vic20/vic.h, plus4/ted-draw.c,
	arch/win32/video.c, arch/unix/x11/gnome/gnomevideo.c,
	arch/unix/x11/xaw/x11video.c, vice.h: Removed chip specific
	double size modes.

	* plus4/plus4mem.c, plus4/plus4mem.c (mem_load_3plus1lo,
	mem_load_3plus1hi): New functions.
	(mem_load): Load 3plus1 ROM images.
	(fdxx_read, fdxx_store): Fixed function names, added ACIA
	register support.

	* plus4/plus4pio2.c, plus4/plus4pio2.h: New files.
	Renamed from plustia1.c and plustia1.h, fixed function names.

	* plus4/plus4acia.c, plus4/plus4acia.h: New files.

	* plus4/ted-mem.c (ted08_store): Fixed function names.

	* plus4/plus4-resources.c: New resources for 3plus1 ROMs.

	* plus4/plus4-cmdline-options.c: New command line options for
	3plus1 ROMs.

	* plus4/plus4.c: Added ACIA resource, command line options,
	initialization and reset functions.

	* plus4/Makefile.am: Added new files.

	* drive/drive-resources.c: New resources for 1551 ROM.

	* drive/drive-cmdline-options.c_ New command line options for
	1551 ROM.

	* drive/drive.c (drive_load_1551): New function.
	(drive_set_disk_drive_type): Load 1551 ROM.

	* drive/drive.h: Added new 1551 constants and prototypes.

